# ===========================================
# 스레드/커넥션 풀 튜닝 실습 환경 설정
# ===========================================

# API 설정
API_PORT=3000
NODE_ENV=production

# ===========================================
# 데이터베이스 설정
# ===========================================
DB_HOST=mysql
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=password
DB_DATABASE=pool_tuning

# ===========================================
# 커넥션 풀 설정 (튜닝 대상)
# ===========================================
# 커넥션 풀 사이즈 (기본값: 10)
#
# [Node.js 환경에서의 계산 공식]
#   필요 커넥션 수 = TPS × 평균 쿼리 시간(초)
#
#   예시:
#   - 500 TPS, 쿼리 10ms  → 500 × 0.01 = 5개
#   - 500 TPS, 쿼리 100ms → 500 × 0.1  = 50개
#   - 1000 TPS, 쿼리 50ms → 1000 × 0.05 = 50개
#
# [주의사항]
#   - Node.js는 비동기 논블로킹 I/O이므로 CPU 기반 공식이 아닌 부하 기반으로 계산
#   - 너무 작으면: waitingRequests 증가, 응답 지연
#   - 너무 크면: MySQL 메모리 낭비, max_connections 초과 위험
#   - MySQL max_connections(기본 151)의 70% 이하로 유지 권장
#
DB_POOL_SIZE=10

# 커넥션 획득 타임아웃 (ms, 기본값: 10000)
# - 풀에서 커넥션을 얻기 위해 대기하는 최대 시간
# - 초과 시 POOL_EXHAUSTED 에러 발생
DB_POOL_ACQUIRE_TIMEOUT=10000

# 유휴 커넥션 타임아웃 (ms, 기본값: 30000)
# - 사용하지 않는 커넥션을 풀에서 제거하는 시간
DB_POOL_IDLE_TIMEOUT=30000

# 대기 큐 제한 (기본값: 0 = 무제한)
# - 커넥션 대기 큐의 최대 길이
DB_QUEUE_LIMIT=0

# ===========================================
# libuv 스레드 풀 설정 (튜닝 대상)
# ===========================================
# libuv 스레드 풀 사이즈 (기본값: 4, 최대: 1024)
#
# [영향받는 작업]
#   - 파일 I/O (fs 모듈의 비동기 함수들)
#   - DNS 조회 (dns.lookup)
#   - crypto 모듈 일부 (pbkdf2, randomBytes 등)
#   - zlib 압축
#   - bcrypt 등 네이티브 애드온
#
# [튜닝 가이드]
#   - CPU 집약 작업이 많으면 증가 고려
#   - 기본값 4는 대부분의 경우 충분
#   - 128 이상은 큰 효과 없음
#
UV_THREADPOOL_SIZE=4

# ===========================================
# 애플리케이션 설정
# ===========================================
# bcrypt 해싱 라운드 (기본값: 12)
# - 높을수록 CPU 사용량 증가
# - 10: 약 100ms, 12: 약 300ms, 14: 약 1초
BCRYPT_ROUNDS=12

# DB 쿼리 로깅 (기본값: false)
DB_LOGGING=false

# Graceful Shutdown 타임아웃 (ms, 기본값: 30000)
SHUTDOWN_TIMEOUT=30000

# ===========================================
# MySQL 설정
# ===========================================
MYSQL_PORT=3306

# ===========================================
# k6 테스트 설정
# ===========================================
K6_SCENARIO=simple-query
